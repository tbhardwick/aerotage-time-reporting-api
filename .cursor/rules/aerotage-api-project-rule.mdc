---
description: 
globs: 
alwaysApply: true
---
# Aerotage Time Reporting API - Backend Repository - Cursor Rules

## ğŸ—ï¸ Repository Architecture Overview

This project uses a **two-repository architecture** to separate concerns:

### ğŸš€ **aerotage-time-reporting-api** (THIS REPOSITORY)
**Purpose**: Backend AWS serverless infrastructure and API
**Current Status**: âœ… **Phase 1-7 Complete, Full Business Solution Deployed**
**Contains**:
- AWS CDK infrastructure code (TypeScript) - âœ… **DEPLOYED**
- AWS Lambda function implementations - âœ… **52+ FUNCTIONS OPERATIONAL**
- DynamoDB table definitions and schema - âœ… **10 TABLES WITH GSIs**
- API Gateway REST API configurations - âœ… **46+ ENDPOINTS LIVE**
- AWS Cognito authentication infrastructure - âœ… **FULLY CONFIGURED**
- CloudWatch monitoring and logging setup - âœ… **ACTIVE MONITORING**
- S3 storage bucket configurations - âœ… **DEPLOYED**
- IAM roles and security policies - âœ… **LEAST PRIVILEGE**
- Comprehensive documentation - âœ… **COMPLETE & ORGANIZED**

### ğŸ“± **aerotage_time_reporting_app** (SEPARATE REPOSITORY)
**Purpose**: Frontend Electron desktop application
**Current Status**: ğŸ”„ **Ready for Complete Integration**
**Contains**: 
- Electron main process, renderer, and preload scripts
- React/TypeScript frontend code
- UI components, pages, and styling
- State management (React Context)
- Frontend configuration and build tools
- Documentation specific to frontend development

### ğŸ”„ **Repository Interaction Rules**
1. **Backend NEVER contains**: Electron code, React components, frontend styling, UI logic
2. **Frontend NEVER contains**: AWS CDK code, Lambda functions, infrastructure definitions
3. **API Endpoints**: âœ… **46+ endpoints implemented and documented**
4. **Authentication**: âœ… **Cognito fully configured, frontend integration ready**
5. **Deployment**: âœ… **Backend infrastructure deployed and operational**

## ğŸ“Š Current Project Status

### âœ… **Completed Features (Production Ready)**
- **User Management**: Profile CRUD, preferences, role-based access âœ… **COMPLETE**
- **Authentication & Security**: JWT tokens, password reset, MFA support âœ… **COMPLETE**
- **Session Management**: Multi-session tracking, device management âœ… **COMPLETE**
- **User Invitations**: Email-based invitation system with role assignment âœ… **COMPLETE**
- **Email Service**: SES integration with professional templates âœ… **COMPLETE**
- **Time Entry Management**: Complete CRUD, timer functionality, approval workflow âœ… **COMPLETE**
- **Project Management**: Project lifecycle, budget tracking, team assignment âœ… **COMPLETE**
- **Client Management**: Customer relationships, billing rates, soft delete âœ… **COMPLETE**
- **Reporting & Analytics**: Business intelligence, real-time analytics, export âœ… **COMPLETE**
- **Invoicing & Billing**: Complete billing cycle, payment tracking, recurring invoices âœ… **COMPLETE**
- **Infrastructure**: Complete AWS CDK deployment with monitoring âœ… **COMPLETE**

### ğŸ”„ **Current Focus**
- **Frontend Integration**: Complete business solution API integration
- **Performance Optimization**: Load testing and optimization
- **Production Deployment**: Staging and production environment setup

### ğŸ“‹ **Next Development Phases**
- **Phase 8**: Advanced Features & Integrations (payment gateways, multi-currency)
- **Production Readiness**: Staging deployment and performance optimization
- **Long-term**: Mobile app, AI features, white-label solution

## ğŸŒ Current Infrastructure

### **Live Environment Details**
- **API Base URL**: `https://k60bobrd9h.execute-api.us-east-1.amazonaws.com/dev/`
- **API Documentation**: Interactive Swagger UI (deployed via CloudFront)
- **Cognito User Pool**: `us-east-1_EsdlgX9Qg`
- **App Client**: `148r35u6uultp1rmfdu22i8amb`
- **Identity Pool**: `us-east-1:d79776bb-4b8e-4654-a10a-a45b1adaa787`
- **Environment**: Development (staging/production ready for deployment)

### **Deployed AWS Resources**
- âœ… **6 CDK Stacks**: Auth, Database, API, Storage, Documentation, Monitoring
- âœ… **10 DynamoDB Tables**: Users, profiles, projects, clients, time entries, invoices, etc.
- âœ… **52+ Lambda Functions**: Complete business functionality across all phases
- âœ… **S3 Buckets**: File storage with lifecycle policies + documentation hosting
- âœ… **CloudFront**: CDN for OpenAPI documentation hosting
- âœ… **CloudWatch**: Comprehensive monitoring and alerting
- âœ… **SES**: Email service with professional templates
- âœ… **OpenAPI Documentation**: Interactive Swagger UI with live API testing

## Core Technology Stack

### Infrastructure & Deployment
- **Infrastructure as Code**: AWS CDK v2 with TypeScript âœ… **DEPLOYED**
- **Compute**: AWS Lambda functions (Node.js 20.x) âœ… **52+ FUNCTIONS**
- **API**: Amazon API Gateway (REST API) âœ… **OPERATIONAL**
- **Database**: Amazon DynamoDB (optimized table design) âœ… **10 TABLES**
- **Authentication**: Amazon Cognito (User Pools + Identity Pools) âœ… **CONFIGURED**
- **Storage**: Amazon S3 (file uploads, exports) âœ… **DEPLOYED**
- **Email**: Amazon SES (templates, delivery tracking) âœ… **ACTIVE**
- **Monitoring**: Amazon CloudWatch (logs, metrics, alarms) âœ… **MONITORING**
- **Security**: AWS IAM (least privilege access) âœ… **IMPLEMENTED**

### Development Tools
- **Language**: TypeScript (strict mode)
- **Package Manager**: npm
- **Linting**: ESLint with AWS CDK recommended rules
- **Testing**: Jest for unit tests, AWS CDK testing constructs
- **Deployment**: AWS CDK CLI with multiple environments

## ğŸ“¡ Implemented API Endpoints

### âœ… **Live Endpoints (Production Ready)**

#### **User Management (Phase 1-3)**
- `GET /users` - List all users (admin/manager)
- `GET /users/{id}/profile` - Get user profile
- `PUT /users/{id}/profile` - Update user profile
- `GET /users/{id}/preferences` - Get user preferences
- `PUT /users/{id}/preferences` - Update user preferences

#### **Security & Authentication (Phase 1-3)**
- `PUT /users/{id}/password` - Change password
- `GET /users/{id}/security-settings` - Get security settings
- `PUT /users/{id}/security-settings` - Update security settings

#### **Session Management (Phase 1-3)**
- `GET /users/{id}/sessions` - List user sessions
- `POST /users/{id}/sessions` - Create session record
- `DELETE /users/{id}/sessions/{sessionId}` - Terminate session

#### **User Invitations (Phase 1-3)**
- `GET /user-invitations` - List invitations
- `POST /user-invitations` - Create invitation
- `POST /user-invitations/{id}/resend` - Resend invitation
- `DELETE /user-invitations/{id}` - Cancel invitation
- `GET /user-invitations/validate/{token}` - Validate token (public)
- `POST /user-invitations/accept` - Accept invitation (public)

#### **Time Entry Management (Phase 4)** âœ… **COMPLETE**
- `GET/POST /time-entries` - Time entry management
- `PUT/DELETE /time-entries/{id}` - Time entry operations
- `POST /time-entries/submit` - Submit for approval
- `POST /time-entries/approve` - Approve entries (managers)
- `POST /time-entries/reject` - Reject entries (managers)

#### **Project & Client Management (Phase 5)** âœ… **COMPLETE**
- `GET/POST /projects` - Project management
- `PUT/DELETE /projects/{id}` - Project operations
- `GET/POST /clients` - Client management
- `PUT/DELETE /clients/{id}` - Client operations

#### **Reporting & Analytics (Phase 6)** âœ… **COMPLETE**
- `POST /reports/time` - Time tracking reports
- `POST /reports/projects` - Project performance reports
- `POST /reports/clients` - Client activity and billing reports
- `POST /reports/export` - Report export functionality
- `GET/POST /reports/schedule` - Scheduled report management
- `POST /analytics/dashboard/enhanced` - Enhanced dashboard generation
- `POST /analytics/real-time` - Real-time analytics
- `POST /analytics/performance` - Performance monitoring
- `POST /analytics/events` - Event tracking
- `POST /analytics/filter` - Advanced data filtering

#### **Invoicing & Billing (Phase 7)** âœ… **COMPLETE**
- `GET/POST /invoices` - Invoice listing and generation
- `PUT /invoices/{id}` - Invoice updates (draft only)
- `POST /invoices/{id}/send` - Send invoice via email
- `PUT /invoices/{id}/status` - Status updates and payment recording
- `GET /invoices/{id}/pdf` - PDF generation
- `GET /invoices/{id}/payments` - Payment history
- `GET/POST /invoice-templates` - Template management
- `GET/POST /invoices/recurring` - Recurring invoice management

### ğŸ“‹ **Future Endpoints (Phase 8+)**
- **Payment Gateway Integration**: Stripe, PayPal, and other processors
- **Advanced Features**: Multi-currency, advanced tax management
- **API Integrations**: Third-party accounting system connections

## File Structure Rules

```
infrastructure/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ aerotage-time-api.ts          # âœ… CDK app entry point
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ cognito-stack.ts              # âœ… Authentication infrastructure
â”‚   â”œâ”€â”€ database-stack.ts             # âœ… DynamoDB tables and indexes
â”‚   â”œâ”€â”€ api-stack.ts                  # âœ… API Gateway and Lambda integrations
â”‚   â”œâ”€â”€ storage-stack.ts              # âœ… S3 buckets and policies
â”‚   â”œâ”€â”€ ses-stack.ts                  # âœ… Email service configuration
â”‚   â”œâ”€â”€ documentation-stack.ts        # âœ… OpenAPI/Swagger UI hosting
â”‚   â””â”€â”€ monitoring-stack.ts           # âœ… CloudWatch logs, metrics, alarms
â”œâ”€â”€ lambda/
â”‚   â”œâ”€â”€ users/                        # âœ… User management functions (6 endpoints)
â”‚   â”œâ”€â”€ security/                     # âœ… Security and auth functions (3 endpoints)
â”‚   â”œâ”€â”€ sessions/                     # âœ… Session management functions (3 endpoints)
â”‚   â”œâ”€â”€ invitations/                  # âœ… User invitation functions (6 endpoints)
â”‚   â”œâ”€â”€ time-entries/                 # âœ… Time tracking functions (5 endpoints)
â”‚   â”œâ”€â”€ projects/                     # âœ… Project management functions (4 endpoints)
â”‚   â”œâ”€â”€ clients/                      # âœ… Client management functions (4 endpoints)
â”‚   â”œâ”€â”€ reports/                      # âœ… Reporting functions (10+ endpoints)
â”‚   â”œâ”€â”€ analytics/                    # âœ… Analytics functions (5 endpoints)
â”‚   â””â”€â”€ invoices/                     # âœ… Invoice management functions (8+ endpoints)
â”œâ”€â”€ test/                             # âœ… CDK and Lambda unit tests
â”œâ”€â”€ scripts/                          # âœ… Build and utility scripts
â”‚   â””â”€â”€ build-openapi.js              # âœ… OpenAPI specification builder
â”œâ”€â”€ docs/                             # âœ… Comprehensive API documentation (ORGANIZED)
â”‚   â”œâ”€â”€ README.md                     # Documentation navigation
â”‚   â”œâ”€â”€ API_REFERENCE.md              # Complete API documentation
â”‚   â”œâ”€â”€ FRONTEND_INTEGRATION_GUIDE.md # Complete integration guide (all phases)
â”‚   â”œâ”€â”€ PROJECT_STATUS.md             # Current implementation status
â”‚   â”œâ”€â”€ PHASE_COMPLETION_ARCHIVE.md   # âœ… Consolidated phase documentation
â”‚   â”œâ”€â”€ openapi.yaml                  # âœ… OpenAPI 3.0 specification
â”‚   â”œâ”€â”€ OPENAPI_DOCUMENTATION.md      # âœ… OpenAPI system documentation
â”‚   â”œâ”€â”€ swagger-ui/                   # âœ… Swagger UI hosting files
â”‚   â”œâ”€â”€ SECURITY_GUIDE.md             # Security implementation
â”‚   â”œâ”€â”€ DEPLOYMENT_GUIDE.md           # Infrastructure deployment
â”‚   â”œâ”€â”€ DEVELOPMENT.md                # Development setup
â”‚   â”œâ”€â”€ LINTING_GUIDE.md              # Code quality standards
â”‚   â”œâ”€â”€ TROUBLESHOOTING.md            # Issue resolution
â”‚   â””â”€â”€ AEROTAGE_TIME_APP_PLAN.md     # Original project plan
â”œâ”€â”€ cdk.json                          # âœ… CDK configuration
â”œâ”€â”€ package.json                      # âœ… Dependencies and scripts
â””â”€â”€ tsconfig.json                     # âœ… TypeScript configuration

# IMPORTANT: NO src/renderer/, public/, or Electron-related files
# Frontend code is maintained in aerotage_time_reporting_app repo
```

## Development Priorities

### **Current Sprint Focus**
1. **Frontend Integration Support**: Complete business solution API integration
2. **Performance Optimization**: Monitor and optimize all 46+ endpoints
3. **Testing Enhancement**: Comprehensive integration testing across all phases
4. **Documentation Maintenance**: Keep consolidated documentation current

### **Next Sprint Preparation**
1. **Phase 8 Planning**: Advanced features and payment gateway integration
2. **Staging Environment**: Deploy complete solution for QA testing
3. **Performance Testing**: Load testing across all business functions
4. **Production Readiness**: Final security audit and monitoring enhancement

### **Production Readiness**
1. **Staging Environment**: Deploy complete business solution for QA testing
2. **Performance Testing**: Load testing and optimization across all phases
3. **Security Review**: Final security audit and penetration testing
4. **Monitoring Enhancement**: Production-grade monitoring and alerting

## AWS CDK Development Rules

### Stack Organization (âœ… **IMPLEMENTED**)
1. **Single Responsibility**: Each stack has one clear purpose
2. **Environment Isolation**: Separate stacks for dev/staging/prod
3. **Resource Naming**: Consistent naming with environment prefixes
4. **Cross-Stack References**: CloudFormation exports for shared resources
5. **Stack Dependencies**: Explicit dependencies defined

### Current Stack Status
- âœ… **CognitoStack**: Authentication and user management
- âœ… **DatabaseStack**: DynamoDB tables with optimized GSIs (10 tables)
- âœ… **ApiStack**: API Gateway with 52+ Lambda functions
- âœ… **StorageStack**: S3 buckets with lifecycle policies
- âœ… **SESStack**: Email service with professional templates
- âœ… **DocumentationStack**: OpenAPI/Swagger UI hosting with CloudFront
- âœ… **MonitoringStack**: CloudWatch monitoring and alerting

## Lambda Function Development Rules

### Function Structure (âœ… **IMPLEMENTED**)
1. **Single Purpose**: Each function has one specific responsibility
2. **Handler Pattern**: Consistent handler pattern across all functions
3. **Error Handling**: Comprehensive error handling and logging
4. **Input Validation**: All inputs validated using TypeScript types
5. **Response Format**: Consistent API response format

### Current Function Status
- âœ… **52+ Functions Deployed**: Complete business functionality across all phases
- âœ… **Standardized Response Format**: Consistent JSON responses
- âœ… **Error Handling**: Comprehensive error handling implemented
- âœ… **Input Validation**: All inputs validated and sanitized
- âœ… **Monitoring**: CloudWatch logging and metrics active

### Function Template (âœ… **STANDARDIZED**)
```typescript
import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda';
import { DynamoDBClient } from '@aws-sdk/client-dynamodb';

export const handler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {
  try {
    // Input validation
    // Business logic
    // Return success response
    return {
      statusCode: 200,
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*'
      },
      body: JSON.stringify({ success: true, data: result })
    };
  } catch (error) {
    console.error('Function error:', error);
    return {
      statusCode: 500,
      body: JSON.stringify({ success: false, error: 'Internal server error' })
    };
  }
};
```

## Database Design Rules (âœ… **IMPLEMENTED**)

### Current Database Status
- âœ… **10 DynamoDB Tables**: Optimized for all business access patterns
- âœ… **Global Secondary Indexes**: Efficient querying for all endpoints
- âœ… **Data Encryption**: All tables encrypted at rest
- âœ… **Backup Strategy**: Point-in-time recovery enabled
- âœ… **Performance**: <200ms average response time

### Implemented Tables
1. **aerotage-main-table-dev**: Primary data table
2. **aerotage-user-profiles-dev**: User profile information
3. **aerotage-user-preferences-dev**: User preferences and settings
4. **aerotage-user-security-settings-dev**: Security configuration
5. **aerotage-password-history-dev**: Password history tracking
6. **aerotage-user-sessions-dev**: Session management
7. **aerotage-user-invitations-dev**: Invitation system
8. **aerotage-user-activity-dev**: Activity logging
9. **aerotage-projects-dev**: Project management
10. **aerotage-clients-dev**: Client management
11. **aerotage-time-entries-dev**: Time tracking
12. **aerotage-invoices-dev**: Invoice management
13. **aerotage-invoice-templates-dev**: Invoice templates
14. **aerotage-payments-dev**: Payment tracking

## Security Implementation (âœ… **ENTERPRISE-GRADE**)

### Authentication & Authorization (âœ… **IMPLEMENTED**)
- âœ… **JWT Tokens**: Cognito JWT tokens for API authentication
- âœ… **Role-Based Access**: Admin, Manager, Employee roles implemented
- âœ… **Password Security**: Strong policies, reset flow, history tracking
- âœ… **Session Management**: Multi-session tracking and control
- âœ… **Account Security**: Lockout protection, MFA support

### Security Features Status
- âœ… **Password Reset**: Email-based reset with secure codes
- âœ… **Security Settings**: User-configurable security options
- âœ… **Session Tracking**: IP, device, location tracking
- âœ… **Audit Logging**: Comprehensive security event logging
- âœ… **Rate Limiting**: Built-in protection against abuse
- âœ… **Financial Data Security**: Invoice and payment data encryption

## API Design Rules (âœ… **IMPLEMENTED**)

### REST API Status
- âœ… **46+ Endpoints**: Complete business functionality across all phases
- âœ… **Consistent Format**: Standardized request/response format
- âœ… **Error Handling**: Comprehensive error responses
- âœ… **Authentication**: Cognito JWT validation on all endpoints
- âœ… **CORS**: Configured for frontend integration
- âœ… **Rate Limiting**: Per-endpoint throttling implemented

### Response Format (âœ… **STANDARDIZED**)
```typescript
// Success Response
{
  "success": true,
  "data": { /* response data */ }
}

// Error Response
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Human readable message",
    "details": { /* additional context */ }
  }
}
```

## ğŸ” API Testing & Authentication (âœ… **CRITICAL INSTRUCTIONS**)

### **MANDATORY Authentication Pattern for All Test Scripts**

**âš ï¸ IMPORTANT**: Always use this exact authentication pattern when creating test scripts. This is the ONLY method that works correctly with our API.

#### **Required Files for Authentication**
1. **`scripts/get-cognito-token.js`** - âœ… **ALREADY EXISTS** - Authentication helper module
2. **Test scripts must import and use this module** - âœ… **VERIFIED WORKING**

#### **Working Authentication Pattern** (âœ… **USE THIS ALWAYS**)
```javascript
#!/usr/bin/env node

const { getCognitoToken } = require('./scripts/get-cognito-token');
const https = require('https');

// Configuration
const API_BASE_URL = 'https://k60bobrd9h.execute-api.us-east-1.amazonaws.com/dev';
const TEST_USER = {
  email: 'bhardwick@aerotage.com',
  password: 'Aerotage*2025'
};

/**
 * Make HTTP request with proper authentication
 */
function makeRequest(url, options = {}) {
  return new Promise((resolve, reject) => {
    const urlObj = new URL(url);
    const requestOptions = {
      hostname: urlObj.hostname,
      port: urlObj.port || 443,
      path: urlObj.pathname + urlObj.search,
      method: options.method || 'GET',
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      }
    };

    const req = https.request(requestOptions, (res) => {
      let data = '';
      res.on('data', (chunk) => data += chunk);
      res.on('end', () => {
        try {
          const jsonData = JSON.parse(data);
          resolve({ status: res.statusCode, data: jsonData });
        } catch (e) {
          resolve({ status: res.statusCode, data: data });
        }
      });
    });

    req.on('error', reject);
    
    if (options.body) {
      req.write(JSON.stringify(options.body));
    }
    
    req.end();
  });
}

/**
 * Main test function
 */
async function testEndpoints() {
  try {
    console.log('ğŸ” Getting JWT token...');
    
    // Get authentication token using the working method
    const authResult = await getCognitoToken(TEST_USER.email, TEST_USER.password);
    const token = authResult.AccessToken; // Use AccessToken, not IdToken
    
    console.log('âœ… JWT token obtained successfully');

    // Test your endpoints here
    const response = await makeRequest(`${API_BASE_URL}/your-endpoint`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    console.log('Response:', response);
    
  } catch (error) {
    console.error('âŒ Test failed:', error);
  }
}

// Run tests
testEndpoints();
```

#### **Authentication Module Details** (âœ… **IMPLEMENTED**)

The `scripts/get-cognito-token.js` module provides:
- **`getCognitoToken(email, password)`** function
- **Returns**: `{ AccessToken, IdToken, RefreshToken }` object
- **Use**: `AccessToken` for API authentication (NOT IdToken)
- **Handles**: Cognito authentication flow correctly

#### **Critical Authentication Rules** (âœ… **FOLLOW ALWAYS**)

1. **ALWAYS import from `'./scripts/get-cognito-token'`** - âœ… **REQUIRED**
2. **ALWAYS use `AccessToken`** from the result - âœ… **CRITICAL**
3. **NEVER use AWS SDK directly** for authentication in test scripts - âŒ **CAUSES 403 ERRORS**
4. **ALWAYS use `Authorization: Bearer ${token}`** header format - âœ… **REQUIRED**
5. **ALWAYS use HTTPS requests** with proper error handling - âœ… **REQUIRED**

#### **Test Credentials** (âœ… **VERIFIED WORKING**)
```javascript
const TEST_USER = {
  email: 'bhardwick@aerotage.com',
  password: 'Aerotage*2025'
};
```

#### **Common Authentication Mistakes to AVOID** (âŒ **THESE CAUSE 403 ERRORS**)

1. **Using AWS SDK directly**:
   ```javascript
   // âŒ DON'T DO THIS - CAUSES 403 FORBIDDEN
   const { CognitoIdentityProviderClient, InitiateAuthCommand } = require('@aws-sdk/client-cognito-identity-provider');
   ```

2. **Using IdToken instead of AccessToken**:
   ```javascript
   // âŒ DON'T DO THIS - CAUSES AUTHORIZATION ISSUES
   const token = authResult.IdToken; // WRONG!
   ```

3. **Not using the get-cognito-token module**:
   ```javascript
   // âŒ DON'T DO THIS - CAUSES AUTHENTICATION FAILURES
   // Custom authentication implementation
   ```

#### **Working Examples** (âœ… **REFERENCE THESE**)

- **`test-user-management-working.js`** - âœ… **WORKING USER MANAGEMENT TESTS**
- **`scripts/test-phase5-endpoints.js`** - âœ… **WORKING PROJECT/CLIENT TESTS**
- **`scripts/test-phase6-core.js`** - âœ… **WORKING REPORTING TESTS**

#### **Authentication Troubleshooting** (âœ… **DEBUG GUIDE**)

If you get **403 Forbidden** errors:
1. **Check**: Are you using `getCognitoToken` from `scripts/get-cognito-token.js`?
2. **Check**: Are you using `AccessToken` (not `IdToken`)?
3. **Check**: Is the Authorization header format correct: `Bearer ${token}`?
4. **Check**: Are you importing the module correctly: `require('./scripts/get-cognito-token')`?

If you get **500 Internal Server Error**:
1. **Check**: CloudWatch logs for the specific Lambda function
2. **Check**: Input validation and request format
3. **Check**: DynamoDB data format issues

#### **Test Script Template** (âœ… **COPY THIS FOR NEW SCRIPTS**)

```javascript
#!/usr/bin/env node

const { getCognitoToken } = require('./scripts/get-cognito-token');
const https = require('https');

// Configuration
const API_BASE_URL = 'https://k60bobrd9h.execute-api.us-east-1.amazonaws.com/dev';
const TEST_USER = {
  email: 'bhardwick@aerotage.com',
  password: 'Aerotage*2025'
};

// [Include makeRequest function from above]

async function testYourEndpoints() {
  try {
    console.log('ğŸ” Getting JWT token...');
    const authResult = await getCognitoToken(TEST_USER.email, TEST_USER.password);
    const token = authResult.AccessToken;
    console.log('âœ… JWT token obtained successfully');

    // Add your specific endpoint tests here
    // Always use: Authorization: `Bearer ${token}`
    
  } catch (error) {
    console.error('âŒ Test failed:', error);
  }
}

testYourEndpoints();
```

### **Why This Authentication Pattern Works** (âœ… **TECHNICAL EXPLANATION**)

1. **Cognito Groups**: The `AccessToken` contains `cognito:groups: ["admin"]` which our custom authorizer reads
2. **Custom Authorizer**: Extracts role from `cognito:groups` when `custom:role` is not available
3. **Session Validation**: The working pattern creates proper session records in DynamoDB
4. **Token Format**: Uses the correct JWT token format that API Gateway expects

**Remember**: This authentication pattern is the result of extensive debugging and is the ONLY method that works reliably with our current infrastructure. Always use it for new test scripts.

## Deployment & Environment Management (âœ… **OPERATIONAL**)

### Environment Status
- âœ… **Development**: Fully operational with complete business functionality
- ğŸ“‹ **Staging**: Ready for complete solution deployment
- ğŸ“‹ **Production**: Infrastructure ready, pending final testing

### Deployment Commands (âœ… **WORKING**)
```bash
# Development environment (âœ… DEPLOYED)
npm run deploy:dev

# Staging environment (ğŸ“‹ READY)
npm run deploy:staging

# Production environment (ğŸ“‹ READY)
npm run deploy:prod

# Destroy environment (dev/staging only)
npm run destroy:dev
```

## Monitoring & Observability (âœ… **ACTIVE**)

### CloudWatch Status
- âœ… **Structured Logging**: JSON format for all log messages
- âœ… **Custom Metrics**: Business KPIs tracking across all phases
- âœ… **Alarms**: Error rates, latency, and cost monitoring
- âœ… **Dashboards**: Real-time system health monitoring
- âœ… **SNS Alerts**: Production alert notifications

### Performance Metrics (âœ… **MONITORED**)
- **API Response Time**: <200ms average across all endpoints
- **Error Rate**: <1% in development
- **Lambda Duration**: Optimized memory allocation
- **DynamoDB Performance**: Efficient query patterns
- **Cost Monitoring**: Billing alerts and anomaly detection

## Testing Requirements (âœ… **IMPLEMENTED**)

### Test Coverage Status
- âœ… **Unit Tests**: 80%+ coverage for critical functions across all phases
- âœ… **Integration Tests**: End-to-end API workflows for complete business solution
- âœ… **Authentication Tests**: Cognito integration scenarios
- âœ… **Security Tests**: Password policies and validation
- âœ… **Business Logic Tests**: Invoice calculations, approval workflows, reporting accuracy
- âœ… **Manual Testing**: All 46+ endpoints verified

## Documentation Status (âœ… **COMPREHENSIVE & ORGANIZED**)

### Available Documentation
- âœ… **Interactive API Documentation**: Live Swagger UI with testing capabilities
- âœ… **OpenAPI Specification**: Complete OpenAPI 3.0 YAML specification (46+ endpoints)
- âœ… **API Reference**: Complete endpoint documentation for all phases
- âœ… **Frontend Integration Guide**: Complete integration guide with all phases
- âœ… **Phase Completion Archive**: Consolidated phase documentation
- âœ… **Project Status**: Current implementation status
- âœ… **Security Guide**: Security features and implementation
- âœ… **Deployment Guide**: Infrastructure deployment instructions
- âœ… **Troubleshooting**: Common issues and solutions
- âœ… **Development Guide**: Local development setup

### Documentation Organization
- **8 Core Documents**: Streamlined, comprehensive coverage
- **300+ Pages**: Complete documentation for all phases
- **100+ Code Examples**: Integration patterns and best practices
- **Consolidated Structure**: Organized for easy navigation and reference

## Development Workflow (âœ… **ESTABLISHED**)

### Git Practices
1. **Conventional Commits**: Use conventional commit format
2. **Feature Branches**: Create branches for each feature/fix
3. **Pull Requests**: Require code review for all changes
4. **Deployment Tags**: Tag deployments with version numbers
5. **Documentation Updates**: Update docs with all changes

### **ğŸ“š Documentation Update Process** (âœ… **AUTOMATED**)

**REQUIRED**: After implementing new API endpoints, always update documentation:

#### **Automated Process** (Recommended)
```bash
# After implementing new endpoints, run:
npm run update:docs
```

This script automatically:
- âœ… Detects new API endpoints from git changes
- âœ… Validates OpenAPI specification syntax
- âœ… Builds JSON specification from YAML
- âœ… Deploys updated documentation to CloudFront
- âœ… Updates project rules with current URLs
- âœ… Commits documentation changes

#### **Manual Process** (If needed)
1. **Update OpenAPI Spec**: Edit `docs/openapi.yaml` with new endpoints
2. **Validate Spec**: `npm run validate:docs`
3. **Build Documentation**: `npm run build:docs`
4. **Deploy**: `cd infrastructure && cdk deploy AerotageDocumentation-dev`
5. **Commit Changes**: `git add docs/ && git commit -m "docs: update API documentation"`

#### **Available Commands**
- `npm run update:docs` - Full automated update process
- `npm run validate:docs` - Only validate OpenAPI specification
- `npm run build:docs` - Build JSON from YAML specification

#### **Documentation Requirements for New Phases**
When implementing new API phases:
1. **Add endpoints to OpenAPI spec** (`docs/openapi.yaml`)
2. **Include comprehensive schemas** for request/response objects
3. **Add detailed descriptions** and examples
4. **Tag endpoints appropriately** for organization
5. **Run automated update process** (`npm run update:docs`)
6. **Test documentation** in live Swagger UI
7. **Update integration guides** if needed

### Code Quality (âœ… **ENFORCED**)
- âœ… **TypeScript**: Strict mode enabled
- âœ… **ESLint**: AWS CDK recommended rules
- âœ… **Testing**: Comprehensive test coverage across all phases
- âœ… **Documentation**: All APIs documented with examples

## Prohibited Practices

### Never Do
- Store secrets or credentials in code or environment variables
- Use deprecated AWS services or APIs
- Implement custom authentication instead of using Cognito
- Create overly broad IAM permissions
- Deploy directly to production without testing
- Use console.log in production (use proper logging)
- Hardcode environment-specific values
- Skip input validation for Lambda functions
- Create circular dependencies between stacks
- Use deprecated CDK constructs
- **Add frontend code (React, Electron, UI) to this repository** âŒ
- **Store frontend dependencies in package.json** âŒ
- **Implement UI logic in Lambda functions** âŒ
- **Include build tools for frontend applications** âŒ

### Always Do
- Follow AWS Well-Architected Framework principles
- Use CDK best practices and design patterns
- Implement proper error handling and logging
- Test infrastructure changes in non-production environments
- Use least privilege access for all IAM roles
- Monitor resource costs and optimize regularly
- Document API changes and breaking changes
- Version APIs and maintain backward compatibility
- **Keep infrastructure and API logic separate from frontend** âœ…
- **Coordinate API changes with frontend team** âœ…
- **Deploy backend infrastructure before frontend testing** âœ…
- **Maintain API documentation for frontend consumption** âœ…

## Current Development Context

### **When Working on This Project**
1. **Complete Business Solution DEPLOYED**: All phases (1-7) operational
2. **46+ APIs are LIVE**: Test against actual deployed endpoints
3. **Documentation is ORGANIZED**: Refer to consolidated `/docs` for accurate information
4. **Frontend Integration Ready**: Support frontend team with complete API integration
5. **Phase 8 Planning**: Prepare for advanced features and payment gateway integration

### **Key Resources**
- **API Base URL**: `https://k60bobrd9h.execute-api.us-east-1.amazonaws.com/dev/`
- **Interactive API Docs**: Live Swagger UI (deployed via CloudFront)
- **OpenAPI Specification**: `/docs/openapi.yaml` for complete API specification
- **Documentation**: `/docs` directory with organized, comprehensive guides
- **Project Status**: `/docs/PROJECT_STATUS.md` for current state
- **API Reference**: `/docs/API_REFERENCE.md` for complete endpoint details
- **Frontend Integration**: `/docs/FRONTEND_INTEGRATION_GUIDE.md` for all phases
- **Phase Archive**: `/docs/PHASE_COMPLETION_ARCHIVE.md` for consolidated phase documentation

### **Development Priorities**
1. **Support complete frontend integration** with all business APIs
2. **Optimize performance** across all 46+ deployed endpoints
3. **Plan Phase 8** advanced features and payment gateway integration
4. **Maintain organized documentation** accuracy
5. **Prepare for production** deployment of complete business solution

### **Business Solution Status**
The Aerotage Time Reporting API now provides a **complete, enterprise-grade business management solution** with:
- **Time Tracking**: Timer functionality and approval workflows
- **Project Management**: Complete project lifecycle management
- **Client Management**: Customer relationship and billing management
- **Reporting & Analytics**: Business intelligence and performance monitoring
- **Invoicing & Billing**: Complete financial management and payment tracking

Remember: This repository contains a **production-ready, complete business management solution** with **46+ live API endpoints** across **7 completed phases**. The focus is now on **complete frontend integration support**, **performance optimization**, and **planning advanced features** for Phase 8 and beyond. 